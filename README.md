# meteo-french-api
Meteo French API

## Mission

Develop a micro-service to expose a weather service.
Using this API : https://developer.accuweather.com/apis

In python, using Flask. 
Implement a python service with two endpoints:
* `/precipitation?lat={latitude}&long={longitude}`:
Returns a json containing the visibility and Amount of precipitation in the last hour
* `/uv?lat={latitude}&long={longitude}`:
Return current UV index

It must be dockerized and deployed on kubernetes using: `kubectl apply -f my_api.yaml`

## Tech Specs

<img src="./doc/meteo-french-api-logo.png" alt="meteo-french-api-logo" width="400"/>

### Background

We build an API, called _Meteo French API_ that will serve weather information to worldwide connected watches.

The API will be integrated in an already existing backend environment hosted in the cloud and deployed with kubernetes.
The backend environment already has a authentication API OpenID Connect standard, a SQL database, a noSQL database and other APIs. Every watches has the ability to authenticate itself through the OpenID API and access APIs.

We have a `X` active watches that will be clients of the _Meteo French API_ and we estimate `XX` calls per day to our new API. Watches are used all over the world and we have `2` (1 in Europe/Paris, 1 in West USA California) backend environments deployed to support worldwide requests (asumption).

We also have 2 other environments for testing purpose :
* `test`:
To run automatic tests.
* `staging`:
To run manual and performance tests.

Our APIs are developped in Python with Flask framework and we follow a set of development rules, among them :
* document APIs with OpenAPI 3.0 standard
* python lint (TBD)
* unittests
* security mitigation

To develop _Meteo French API_ we will use a third party API dedicated to weather information : [AccuWeather](https://developer.accuweather.com/apis).


### Goals

Develop, document, test and deploy the _Meteo French API_ a micro-service to expose a weather service.
Using this API : https://developer.accuweather.com/apis

In *Python*, using *Flask* with *2 endpoints*:
* `/precipitation?lat={latitude}&long={longitude}`:
Returns a json containing the visibility and Amount of precipitation in the last hour
* `/uv?lat={latitude}&long={longitude}`:
Return current UV index

It must be dockerized and deployed on kubernetes using: `kubectl apply -f my_api.yaml`

This API must be presented on the Jan 4th 2022, and therefore be ready some days before (Dec 30th 2021 deadline)


### Non-goals

* We suppose we have a authentication micro-service with OpenID Connect standard and won't develop a authentication system. Our API will consume a JWT that will be generated by the authentication service beforehand.
* Due to planning restrictions, the work will focus on the code more than testing, security, deployment and monitoring process and performance optimization. But this document purpose is also to highlight weaknesses of the current implementation and propose improvements.

### Plan / Milestones

- [] Register for https://developer.accuweather.com/apis and get to know the app with documentation
- [] Write a AccuWeather API client with the core logics of the _Meteo French API_ in a [Jupyter notebook]()
- [] Write the API spec with OpenAPI 3.0 standard with [Insomnia](https://insomnia.rest/)
- [] Generate Python Flask structure from the spec with Insomnia
- [] Fill the structure with core logics from notebook
- [] Write unit tests for core logics functions
- [] Write unit tests for API
- [] Write `meteo-french-api.yaml` k8s spec to deploy and test to deploy locally with `minikube`.

- [] JWT Authentication implemetation and unit tests
- [] Deployment in AKS in 1 `test` environment
- [] Static code analysis for security
- [] Integrate monitoring features (Sentry, ELK, Prometheus)

- [] Deployment in `staging`
- [] End-to-end validation in `staging` with connected watches *(need the API client development to be ready)*
- [] Load and performance tests in `staging`
- [] Deployment in `prod` worldwide
- [] Monitoring during _pilote_ period: The watch software version that include the weather client feature is deployed only on 10% of all the units
- [] Scale pilote: 10% (2 weeks) => 50% (2 weeks) => 100%

### KPI / Monitoring

* Sentry for logs

Grafana board (To be defined, we'll do the same as the other APIs) :
* Status codes (no-go if `2XX < 80%` ?)
* Time response per endpoint (objective: `200ms` ?)
* Requests history (per hour)
* Requests geography

Kibana board
* Requests per user id (info from JWT) => for security purpose to check they are known authenticated users.
* Lat/Lng (in request params) vizualisation ? => it might drive possible optimizations


### Open Questions

- [] How to store our AccuWeather Token securely ? `.env` files ? [git-secret](https://git-secret.io/)

